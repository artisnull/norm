!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.norm=e():t.norm=e()}(global,function(){return function(t){var e={};function r(n){if(e[n])return e[n].exports;var o=e[n]={i:n,l:!1,exports:{}};return t[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)r.d(n,o,function(e){return t[e]}.bind(null,o));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=0)}([function(t,e,r){"use strict";r.r(e);var n={subNodes:{}},o={omit:!1,resolve:void 0,filter:void 0,transform:void 0,additionalIds:void 0},i={silent:!0},a=function(){return{byId:{},allIds:[]}};function u(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=[],n=!0,o=!1,i=void 0;try{for(var a,u=t[Symbol.iterator]();!(n=(a=u.next()).done)&&(r.push(a.value),!e||r.length!==e);n=!0);}catch(t){o=!0,i=t}finally{try{n||null==u.return||u.return()}finally{if(o)throw i}}return r}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function f(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(t){return Object.getOwnPropertyDescriptor(r,t).enumerable}))),n.forEach(function(e){s(t,e,r[e])})}return t}function s(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function c(t){return(c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function l(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:o;if(e&&("object"!==c(e)||Array.isArray(e)))throw new Error("SubNodes must be an object in the form {[subNodeName]: idToNormalizeBy}");var n={},i=f({},e);return Object.entries(i).forEach(function(e){var r=u(e,2),o=r[0],a=r[1],f=new y(o,t.norm);t.norm.nodes.set(f.sym,f.toObject()),i[f.sym]=a,delete i[o],n[o]=f}),this.norm.nodes.set(this.sym,f({},this.norm.nodes.get(this.sym),{subNodes:i},r)),n}function d(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var y=function(){function t(e,r){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.subNodes={},this.omit=!1,this.define=l,this.name=e,this.sym=Symbol(e),this.norm=r,this}var e,r,n;return e=t,(r=[{key:"toObject",value:function(){var t=this;return["name","subNodes","sym","resolve","omit","filter","transform","additionalIds"].reduce(function(e,r){return e[r]=t[r],e},{})}}])&&d(e.prototype,r),n&&d(e,n),t}();function b(t){return(b="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function m(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:o;if(this.root)throw new Error("Root has already been defined, ".concat(t," is attempting to redefine"));if(!t)throw new Error("Nodes must be named. First argument must be a string");if(e&&("object"!==b(e)||Array.isArray(e)))throw new Error("SubNodes must be an object in the form {[subNodeName]: idToNormalizeBy}");var n=new y("root",this);this.root=n.sym,this.nodes.set(this.root,n.toObject());var i,a,u,f=n.define((u="id",(a=t)in(i={})?Object.defineProperty(i,a,{value:u,enumerable:!0,configurable:!0,writable:!0}):i[a]=u,i),{omit:!0})[t];return this.firstNode=f.sym,f.define(e,r)}function h(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function p(t){return(p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function v(t){if(!this.root)throw new Error("No root is defined.");var e=t,r=this.nodes.get(this.root);if(Array.isArray(t)||"object"!==p(t)){if(!Array.isArray(t))throw new Error("Data must be an array or object. Recieved ".concat(p(t)));e=h({},this.nodes.get(this.firstNode).name,t)}else e=h({},r.name,t);return this._normalizeNode(e,r),this.normData}function g(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function w(t){return(w="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function O(t,e){var r=this,n=e.name,o=e.subNodes,i=void 0===o?{}:o,a=e.resolve;Object.getOwnPropertySymbols(i).forEach(function(e){var o,u,f=i[e],s=r.nodes.get(e),c=s.name,l=s.additionalIds,d=s.transform,y=s.filter,b=s.omit,m=t[c];if(a){if("object"!==w(a))throw new Error("resolve must be an object, where the subNodes to resolve are the keys, and the resolve functions are the respective values.");if(a[c]&&"function"==typeof a[c]&&"string"==typeof a[c](t)){var h=a[c](t).split(".");h.shift(),u=h.pop(),m=(o=h.reduce(function(t,e){return t[e]},t))[u]}else if(a[c])throw new Error("resolve must be an object, where the subNodes to resolve are the keys, and the values are functions that return strings describing the path to resolve.")}if(m){r._normalizeNode(m,s);var p=!Array.isArray(m),v=r._formatArr({data:p?[m]:m,id:f,additionalIds:l,transform:d,filter:y}),O=p?[m[f]]:v.allIds;a?(delete o[u],o[s.name]=O):t[s.name]=O,!b&&r._addNormData(function(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(t){return Object.getOwnPropertyDescriptor(r,t).enumerable}))),n.forEach(function(e){g(t,e,r[e])})}return t}({},v,{nodeName:c}))}else!r.silent&&console.warn("Couldn't locate ".concat(c," in ").concat(n,". Ensure nodes and subNodes match."))})}function j(t,e){var r=this;t&&(Array.isArray(t)?t.forEach(function(t){r._normalizeSubNodes(t,e)}):this._normalizeSubNodes(t,e))}function S(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function N(t){var e=this,r=t.data,n=t.id,o=t.additionalIds,i=void 0===o?[]:o,a=t.transform,u=void 0===a?function(t){return t}:a,f=t.filter,s=void 0===f?function(t){return!0}:f,c={},l=[];return r.forEach(function(t){if(s(t))if(c[t[n]]=function(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(t){return Object.getOwnPropertyDescriptor(r,t).enumerable}))),n.forEach(function(e){S(t,e,r[e])})}return t}({},u(t),{id:t[n]}),i.length<1)l.push(t[n]);else{var r={id:t[n]};i.forEach(function(e){r[e]=t[e]}),l.push(r)}else e.silent||console.warn({message:"Data element has been filtered",element:t,fn:s.toString()})}),{byId:c,allIds:l}}function P(t){return function(t){if(Array.isArray(t)){for(var e=0,r=new Array(t.length);e<t.length;e++)r[e]=t[e];return r}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function A(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(t){return Object.getOwnPropertyDescriptor(r,t).enumerable}))),n.forEach(function(e){E(t,e,r[e])})}return t}function E(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function _(t){var e=this,r=t.byId,n=t.allIds,o=t.nodeName,i=this.normData[o]||a(),u=this.normData[o]?n.filter(function(t){return!e.normData[o].byId[t]}):n;this.normData=A({},this.normData,E({},o,A({},i,{byId:A({},i.byId,r),allIds:[].concat(P(i.allIds),P(u))})))}var I=function t(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:i).silent,r=void 0===e||e;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.addRoot=m,this.normalize=v,this._normalizeSubNodes=O,this._normalizeNode=j,this._formatArr=N,this._addNormData=_,this.nodes=new Map,this.root=null,this.normData={},this.silent=r};r.d(e,"default",function(){return I}),r.d(e,"addRoot",function(){return m}),r.d(e,"define",function(){return l}),r.d(e,"normalize",function(){return v}),r.d(e,"_normalizeSubNodes",function(){return O}),r.d(e,"_normalizeNode",function(){return j}),r.d(e,"_formatArr",function(){return N}),r.d(e,"_addNormData",function(){return _}),r.d(e,"defaultNode",function(){return n}),r.d(e,"defaultOptions",function(){return o}),r.d(e,"defaultConfig",function(){return i}),r.d(e,"newNormStruct",function(){return a})}])});